# DB 및 웹 스크래핑 스크립트

이 디렉토리에는 `gagaon.com` 웹사이트에서 데이터를 수집(스크래핑)하고, 간단한 API 서버를 실행하는 Node.js 스크립트들이 포함되어 있습니다. 모든 스크래핑 데이터는 로컬 MongoDB에 저장됩니다.

## 파일 상세 설명

### `Lnumber_puppeteer.js`
`gagaon.com`의 '복지인증 정보'를 스크래핑하는 메인 스크립트입니다. Puppeteer를 사용하여 실제 브라우저처럼 동작하며, 자동 로그인을 수행합니다.

#### 주요 기능
-   봇 탐지를 우회하기 위해 `puppeteer-extra`와 `stealth` 플러그인을 사용합니다.
-   스크립트 내에 하드코딩된 아이디와 비밀번호를 사용하여 자동으로 로그인합니다.
-   로그인 후 '복지인증 정보' 페이지로 이동하여 등록된 모든 사용자의 상세 정보를 수집합니다.
-   수집된 정보는 `welfare_db` 데이터베이스의 `seniors` 컬렉션에 저장됩니다. (기존 데이터는 업데이트, 신규 데이터는 추가)

#### 실행 순서 (Flow)
1.  스텔스 모드가 적용된 Puppeteer 브라우저를 실행합니다.
2.  로그인 페이지(`https://gagaon.com/bbs/login.php`)로 이동합니다.
3.  아이디/비밀번호 입력 필드가 나타날 때까지 대기합니다.
4.  코드에 저장된 아이디(`dongnebangne1@naver.com`)와 비밀번호를 자동으로 입력합니다.
5.  로그인 버튼을 클릭하고 페이지 전환을 기다립니다.
6.  로그인 성공 후, '복지인증 정보' 페이지(`https://gagaon.com/biz/senior.php`)로 이동합니다.
7.  페이지에 정보 목록이 표시될 때까지 대기합니다.
8.  브라우저 내에서 스크립트를 실행하여 이름, 성별, 인증번호, 남은 금액 등 모든 정보를 추출합니다.
9.  MongoDB `welfare_db`에 연결합니다.
10. 추출된 각 정보에 대해 인증번호(`certNumber`)를 기준으로 기존 데이터가 있는지 확인합니다.
11. 데이터가 이미 존재하면 최신 정보로 업데이트하고, 없으면 새로운 데이터로 추가합니다.
12. 모든 작업이 끝나면 브라우저와 MongoDB 연결을 종료합니다.

---
### `carScraperAll.js`
`gagaon.com`에 있는 **모든 상품** 정보를 수집하는 포괄적인 스크래핑 스크립트입니다.

#### 주요 기능
-   Cheerio와 Axios 라이브러리를 사용하여 HTML을 직접 요청하고 파싱합니다. (브라우저 실행 X)
-   먼저 사이트의 모든 서브 카테고리 정보를 가져옵니다.
-   각 카테고리를 순회하며, 페이징(Paging)을 처리하여 마지막 페이지까지 모든 상품의 URL을 추출합니다.
-   추출된 각 상품 URL에 접속하여 상품명, 가격, 이미지, 상세 정보 등을 수집합니다.
-   수집된 정보는 `welfare_db` 데이터베이스의 `welfareitems` 컬렉션에 저장됩니다.

---
### `CatScraper.js`
`carScraperAll.js`의 축소 버전으로, **특정 단일 카테고리**('목욕의자')의 상품들만 수집합니다. 전체 스크래핑 전 특정 카테고리의 동작을 테스트하는 데 유용합니다.

---
### `scraper.js`
가장 기본적인 스크래핑 스크립트입니다. **특정 단일 상품**의 URL 하나에 대해서만 상세 정보를 수집합니다. 상품 상세 페이지의 HTML 구조가 변경되었을 때 선택자(selector)를 테스트하는 용도로 사용하기 좋습니다.

---
### `index.js`
스크래핑과는 별개로, 간단한 웹 API 서버를 실행하는 테스트용 파일입니다.

#### 주요 기능
-   Express.js 프레임워크를 사용합니다.
-   3001번 포트로 서버를 실행합니다.
-   `test` 데이터베이스의 `users` 컬렉션에 대한 사용자 조회(`GET /users`) 및 생성(`POST /users`) API를 제공합니다.

---

## 사용 방법

### 1. 사전 준비
-   Node.js 설치
-   MongoDB 서버 실행

### 2. 라이브러리 설치
`db` 디렉토리로 이동하여 필요한 라이브러리를 설치합니다.
```bash
cd db
npm install
```

### 3. 스크립트 실행
-   **복지인증 정보 스크래핑:**
    ```bash
    node Lnumber_puppeteer.js
    ```
-   **모든 상품 정보 스크래핑:**
    ```bash
    node carScraperAll.js
    ```
-   **API 서버 실행:**
    ```bash
    node index.js
    ```
